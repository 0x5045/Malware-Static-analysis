import sys 
import ctypes
import hashlib, urllib, urllib2, json, os
import base64
import time
import requests


#////////////////////////////////////////////////////////////////
#	 To color output
#////////////////////////////////////////////////////////////////
os.system("color F")
#////////////////////////////////////////////////////////////////
k = base64.b64decode('base64apikey here')

	
def VtScan(md5):	

	#rescan(md5)
	#time.sleep(10)
	params = {'apikey': k, 'resource': md5}
	headers = {
	"Accept-Encoding": "gzip, deflate",
	"User-Agent" : "gzip, Python requests for scan"
	}
	response = requests.post('https://www.virustotal.com/vtapi/v2/file/report',
	params=params)
	json_response = str(response.json())
	
	jsplit = json_response.split(',')
	counter = 0
	print '\n\n\n'
	print 'MD5: ' + md5 
	
	print '\n'
	for item in jsplit:
		item = item.replace('u\'','')
		item = item.replace('\'','')
		if 'BitDefender' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'BitDefender: '+str(det_name)
		elif 'Kaspersky' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'Kaspersky:   '+str(det_name)
		elif 'McAfee' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'McAfee:      '+str(det_name)
		elif 'Microsoft' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'Microsoft:   '+str(det_name)
		elif 'Sophos' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'Sophos AV:   '+str(det_name)
		elif 'QuickHeal' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'QuickHeal:   '+str(det_name)
		elif 'Comodo' in item: 
			det_name = jsplit[counter+2].replace('u\'','')
			det_name = det_name.replace('\'','')
			det_name = det_name.replace('result:','')
			print 'Comodo:      '+str(det_name)
		
		#print str(counter) +'  '+ str(item)
		counter +=1
		
	
	
		
	#jsplit = json_response.split(',')
	#print len(jsplit)
	print '\n\n\n'
	try:
		print 'Scan Date:'+jsplit[4].split(':')[1].replace('u\'','') #scan date
		print 'Detected By:'+jsplit[9].split(':')[1].replace('\'','') #scan date #scan result
	except:
		print 'Data-'
		print md5
		print 'error file not found'
	

	
#hashlib.md5(sys.argv[1]).hexdigest()
print sys.argv[1]
VtScan(str(hashlib.md5(open(sys.argv[1],'rb').read()).hexdigest()))
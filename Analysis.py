import os
import sys
import Analysis_functions as functions

input_file = sys.argv[1]

file_list = []

if os.path.isdir(input_file):
	for root,dirs,files in os.walk(input_file):
		for file in files:
			file_path = root + '\\' + file
			print(file_path)
			file_path = os.path.normpath(file_path)
			file_list.append(file_path)
			
elif os.path.isfile(input_file):
	file_list.append(input_file)
else:
	print('Invalid File Path')
	sys.exit()

for listed_input_file in file_list:	
	final_out = "\nStrings Analysis Of : "+ str(listed_input_file) + '\n' 
	
	out_retrived_pe_struct = functions.Retrive_data_from_PE(listed_input_file)
	if 'not a PE File' in out_retrived_pe_struct:
		pass
	else:
		#comment
		out_path = "output_files"
		if not os.path.exists(out_path):
			os.mkdir("output_files")
		out_hand = open(out_path+"\\"+str(listed_input_file.split('\\')[-1])+'.txt','w')
		out_hand.write('Analysis of :' + str(listed_input_file)+'\n')
		out_hand.write(out_retrived_pe_struct)
		out_hand.write(final_out)
		out_list = functions.Retrive_and_Classify_strings(listed_input_file)
		for item in out_list:
			out_hand.write(item)